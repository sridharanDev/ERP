<div class="card">
    <div class="card-body">
        <div class="d-flex justify-content-between mb-3">
            <h5 class="card-title">Ongoing projects</h5>
        </div>
        <div class="">
            <table id="datatable" datatable [dtOptions]="dtOptions" [dtTrigger]="dtTrigger" class="table table-striped table-bordered">
                <thead class="">
                    <tr>
                        <th>S.No</th>
                        <th>Client Name</th>
                        <th>Platform</th>
                        <th>Project Name</th>
                        <th>Status</th>
                        <th [width]="50">Action</th>
                    </tr>
                </thead>
                <tbody>
                    <ng-container *ngFor="let project of allProjects; index as i;">
                        <tr *ngIf="project.status === 'ongoing'">
                          <td>{{i + 1}}</td>
                          <td>{{project.client_name}}</td>
                          <td>{{project.platform}}</td>
                          <td>{{project.project_name}}</td>
                          <td><div class="badge bg-success" (click)="openModal(editRoleModel,project._id)" style="cursor: pointer;">{{project.status | titlecase}}</div></td>
                          <td style="text-align: center;">
                            <button type="button" class="btn btn-primary btn-sm me-2" data-bs-toggle="dropdown">Action</button>     
                            <div class="dropdown">
                                <div class="dropdown-menu dropdown-menu-end">
                                    <a class="dropdown-item" (click)="openModal(editRoleModel,project._id)">Status</a>
                                    <a class="dropdown-item"  routerLink="/admin/billing" [queryParams]="{projectId:project._id}">Billing</a>
                                    <a class="dropdown-item"  routerLink="/admin/project/assign-staffs/{{project._id}}">Staffs</a>
                                    <a class="dropdown-item"  routerLink="/admin/project/{{project._id}}">View</a>
                                    <a class="dropdown-item"  routerLink="/admin/edit-project/{{project._id}}">Edit</a>
                                    <a class="dropdown-item"  (click)="openModal(deleteStaffModel,project._id)">Delete</a>
                                </div>
                            </div>  
                          </td>
                        </tr>
                      </ng-container>
                    
                </tbody>
                
            </table>
        </div>

    </div>
</div>




<ng-template #editRoleModel let-modal>
    <div class="modal-header">
        <h3 class="modal-title">Edit Status</h3>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <form [formGroup]="statusForm" (ngSubmit)="EditFormSubmit()">
        <div class="modal-body">
            <Strong>Name: </Strong>{{selectedRow.project_name}}
            <div class="form-group m-t-20">
                <label>Status</label>
                <!-- <input type="text" class="form-control"  placeholder="Role name" formControlName="status" [ngClass]="{'is-invalid': isInvalidField(statusForm.get('status'))}"> -->
                <select class="form-select" formControlName="status" [ngClass]="{'is-invalid': isInvalidField(statusForm.get('status'))}">
                    <option value="">Select Status</option>
                    <option value="">Select Status</option>
                    <option value="pipeline">Pipeline</option>
                    <option value="call back">Call back</option>
                    <option value="upcomming">Upcomming</option>
                    <option value="ongoing">Ongoing</option>
                    <option value="completed">Completed</option>
                  </select>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary " (click)="modal.dismiss()" >Cancel</button>
            <button type="submit" class="btn btn-warning " >Update</button>
        </div>
    </form>
</ng-template>





<ng-template #deleteStaffModel let-modal>
    <div class="modal-header">
        <h3 class="modal-title">Delete project</h3>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
        <div class="modal-body">
            <Strong>Name: </Strong>{{selectedRow.project_name}}
            <p>Do you want to delete this project.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary " (click)="modal.dismiss()" >Cancel</button>
          <button type="button" class="btn btn-danger " (click)="DeleteSubmit()" >Delete</button>

        </div>
</ng-template>

<app-loading *ngIf="isLoading"></app-loading>